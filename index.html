<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>namics</title>
<link rel="icon" href="assets/icon.png" type="image/png" />
<style>
/* ======================
   CONFIGURE: easy edits
   ======================
   - Change accent color below (one place)
   - Change discord invite or song URL in the JS config area
*/
:root{
  --accent: #8a7aff;
  --accent-2: #ff6b88;
  --bg-dark: #050507;
  --bg-dark-2: #0b0b14;
  --card-bg: rgba(15,15,20,0.65);
  --muted: #b0b0b6;
  --glass-blur: 12px;
  --max-width: 720px;
  --focus: rgba(138,122,255,0.18);
  --radius: 16px;
  --transition-fast: 180ms;
  --transition-slow: 420ms;
}

/* ----------------------
   Basic reset and layout
   ---------------------- */
*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0;
  font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
  color:#fff;
  background: radial-gradient(1200px 700px at 10% 20%, rgba(138,122,255,0.04), transparent 6%),
              radial-gradient(900px 600px at 90% 85%, rgba(255,107,136,0.02), transparent 6%),
              linear-gradient(140deg, var(--bg-dark), var(--bg-dark-2));
  -webkit-font-smoothing:antialiased;
  -moz-osx-font-smoothing:grayscale;
  display:flex;
  align-items:center;
  justify-content:center;
  min-height:100vh;
  overflow:hidden;
  position:relative;
  background-attachment: fixed;
}

/* ----------------------
   Accessible hidden text
   ---------------------- */
.sr-only{
  position:absolute;
  width:1px;height:1px;
  padding:0;margin:-1px;
  overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0;
}

/* ======================
   Particle layers: deep, mid, near
   ====================== */
.particles-layer{
  position:fixed;inset:0;pointer-events:none;z-index:0;mix-blend-mode:screen;
}
.particles-layer canvas{width:100%;height:100%;display:block}

/* ======================
   Main container & card
   ====================== */
.wrapper{position:relative;z-index:2;display:flex;align-items:center;justify-content:center;width:100%;padding:28px}
.card{
  width:100%;
  max-width:var(--max-width);
  background:var(--card-bg);
  border-radius:var(--radius);
  padding:46px;
  box-shadow:0 12px 50px rgba(0,0,0,0.55);
  border:1px solid rgba(255,255,255,0.04);
  backdrop-filter: blur(var(--glass-blur));
  -webkit-backdrop-filter: blur(var(--glass-blur));
  transform-style:preserve-3d;
  transition: transform var(--transition-slow) cubic-bezier(.2,.9,.3,1), box-shadow var(--transition-fast);
  position:relative;
  overflow:visible;
  text-align:center;
}

/* subtle top sheen */
.card::after{
  content:"";
  position:absolute;left:-30%;top:-20%;width:160%;height:40%;
  background:linear-gradient(90deg, rgba(255,255,255,0.02), rgba(255,255,255,0.06), rgba(255,255,255,0.02));
  transform:skewX(-12deg);
  pointer-events:none;
  opacity:0.9;
  filter: blur(6px);
}

/* hover lift */
.card:hover{ transform: translateY(-6px); box-shadow:0 20px 80px rgba(0,0,0,0.65) }

/* --------------------
   Avatar & identity
   -------------------- */
.avatar{
  width:140px;height:140px;margin:0 auto 22px;border-radius:50%;overflow:hidden;border:2px solid rgba(255,255,255,0.12);
  box-shadow:0 8px 30px rgba(138,122,255,0.12);cursor:pointer;transition: transform .45s cubic-bezier(.22,.9,.3,1);
}
.avatar img{width:100%;height:100%;object-fit:cover;display:block;user-drag:none;pointer-events:none}
.avatar:active{transform:scale(.98)}

/* --------------------
   Username - non-selectable
   -------------------- */
.username{
  font-size:44px;
  font-weight:800;
  letter-spacing:0.6px;
  display:inline-block;
  margin:6px 0 6px;
  background:linear-gradient(90deg,#fff,var(--accent));
  background-size:200%;
  -webkit-background-clip:text;
  -webkit-text-fill-color:transparent;
  animation: shimmering 4s linear infinite;
  user-select:none; -webkit-user-select:none; -moz-user-select:none;
  cursor:default;
}
@keyframes shimmering{0%{background-position:0%}100%{background-position:200%}}

/* subtitle line */
.subtitle{color:var(--muted);margin-top:6px;font-size:14px}

/* divider */
.divider{height:1px;width:76%;margin:28px auto;background:linear-gradient(90deg,transparent,var(--accent),transparent);opacity:.55;border-radius:6px}

/* --------------------
   Now playing + visualizer
   -------------------- */
.now-playing{
  margin-top:14px;display:flex;align-items:center;justify-content:center;gap:12px;color:var(--muted);font-size:13px;opacity:0.95;
}
.now-dot{width:8px;height:8px;border-radius:50%;background:var(--accent);box-shadow:0 0 10px rgba(138,122,255,0.3)}
.visualizer{
  display:inline-flex;align-items:flex-end;gap:4px;height:20px;margin-left:10px;
}
.vis-bar{width:6px;height:6px;background:linear-gradient(180deg,var(--accent),var(--accent-2));border-radius:2px;transition:height 120ms linear}

/* --------------------
   Links area (single button)
   -------------------- */
.links{display:flex;flex-direction:column;gap:14px;align-items:center;margin-top:28px}
.linkBtn{
  display:inline-flex;align-items:center;gap:12px;padding:12px 28px;border-radius:999px;
  background:linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.02));
  border:1px solid rgba(255,255,255,0.06);text-decoration:none;color:#fff;font-weight:600;
  box-shadow: 0 6px 25px rgba(0,0,0,0.45);
  transition: transform var(--transition-fast), box-shadow var(--transition-fast), background var(--transition-fast);
  position:relative;overflow:hidden;
}
.linkBtn .dotIcon{width:9px;height:9px;border-radius:50%;background:var(--accent);box-shadow:0 0 12px rgba(138,122,255,0.24)}
.linkBtn:hover{transform:translateY(-4px);box-shadow:0 14px 40px rgba(0,0,0,0.6)}
.linkRow{display:flex;gap:10px;align-items:center}

/* tooltip small for copy feedback */
.toast{
  position:fixed;left:50%;transform:translateX(-50%);bottom:24px;background:rgba(10,10,12,0.9);color:#fff;padding:8px 14px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);
  box-shadow:0 8px 30px rgba(0,0,0,0.5);opacity:0;pointer-events:none;transition:opacity .18s ease, transform .18s ease;z-index:999;
}

/* focus outline for keyboard nav */
.linkBtn:focus{outline:none;box-shadow:0 0 0 6px var(--focus)}

/* --------------------
   Theme toggle pill
   -------------------- */
.controls{position:absolute;top:18px;right:18px;z-index:5;display:flex;gap:10px;align-items:center}
.theme-toggle{display:inline-flex;align-items:center;gap:8px;padding:8px 12px;border-radius:999px;background:rgba(0,0,0,0.25);border:1px solid rgba(255,255,255,0.04);cursor:pointer;color:var(--muted);font-size:13px}
.theme-toggle:focus{outline:none;box-shadow:0 0 0 6px rgba(138,122,255,0.12)}

/* small config menu */
.config{position:absolute;left:18px;top:18px;color:var(--muted);font-size:13px;display:flex;gap:8px;align-items:center;z-index:5}
.small-btn{background:transparent;border:1px solid rgba(255,255,255,0.04);padding:6px 8px;border-radius:8px;color:var(--muted);cursor:pointer}
.small-btn:focus{outline:none;box-shadow:0 0 0 6px rgba(138,122,255,0.08)}

/* --------------------
   Confetti canvas (easter egg)
   -------------------- */
.confetti-canvas{position:fixed;inset:0;pointer-events:none;z-index:999}

/* --------------------
   Responsive
   -------------------- */
@media (max-width:880px){
  .username{font-size:34px}
  .avatar{width:112px;height:112px}
  .card{padding:34px}
}
@media (max-width:480px){
  .username{font-size:28px}
  .avatar{width:94px;height:94px}
  .card{padding:20px}
  .divider{width:95%}
}

/* --------------------
   LIGHT THEME (toggle)
   -------------------- */
:root.light{
  --accent: #645cff;
  --accent-2: #ff7fa6;
  --bg-dark: #f4f4f6;
  --bg-dark-2: #eaeaf0;
  --card-bg: rgba(255,255,255,0.85);
  --muted: #5a5a66;
  --glow: rgba(100,92,255,0.08);
  color:#0b0b0b;
}
</style>
</head>
<body>
<!-- =========================
     CONFIGURATION (JS will read this)
     Edit values below if desired
     ========================= -->
<script>
  window.__NAMICS_CONFIG = {
    discordInvite: 'https://discord.gg/bribe',
    nowPlayingLabel: 'Now playing',
    usernameText: 'namics',
    subtitleText: 'creating through chaos',
    audioSrc: 'assets/song.mp3',
    accent: '#8a7aff'
  };
</script>

<!-- Particle canvas layers -->
<div class="particles-layer" aria-hidden="true">
  <canvas id="particles-deep"></canvas>
  <canvas id="particles-mid"></canvas>
  <canvas id="particles-near"></canvas>
</div>

<!-- confetti/effects -->
<canvas id="confetti" class="confetti-canvas" aria-hidden="true"></canvas>

<!-- toast -->
<div id="toast" class="toast" role="status" aria-live="polite">Copied!</div>

<!-- controls -->
<div class="controls" aria-hidden="false">
  <button id="themeToggle" class="theme-toggle" aria-pressed="false" title="Toggle light/dark theme">Theme</button>
</div>

<!-- small config quick actions -->
<div class="config" aria-hidden="true">
  <button id="copyInviteQuick" class="small-btn" title="Copy invite link">Copy Invite</button>
</div>

<!-- main card -->
<div class="wrapper" role="main">
  <main class="card" id="mainCard" role="region" aria-label="namics profile card">
    <div class="avatar" id="avatarBtn" tabindex="0" aria-label="Profile avatar (double click for surprise)">
      <img src="assets/pfp.png" alt="namics profile picture" draggable="false">
    </div>

    <div class="identity">
      <div class="username" id="username" aria-label="username" role="heading" data-text="">namics</div>
      <div class="subtitle" id="subtitle">creating through chaos</div>
      <div class="now-playing" aria-hidden="false">
        <div class="now-dot" aria-hidden="true"></div>
        <div id="nowLabel" style="opacity:.95">Now playing</div>
        <div class="visualizer" id="visualizer" aria-hidden="true">
          <!-- bars generated by JS -->
        </div>
      </div>
    </div>

    <div class="divider" role="separator" aria-hidden="true"></div>

    <div class="links" role="navigation" aria-label="links">
      <a id="discordBtn" class="linkBtn" href="#" target="_blank" rel="noopener" title="Open Discord invite">
        <span class="dotIcon" aria-hidden="true"></span>
        <div class="linkRow"><span id="discordText">.gg/bribe</span></div>
      </a>
      <button id="copyBtn" class="linkBtn" title="Copy invite to clipboard">
        <span class="dotIcon" aria-hidden="true"></span>
        <div class="linkRow"><span>Copy Invite</span></div>
      </button>
    </div>
  </main>
</div>

<!-- Hidden audio element used by visualizer -->
<audio id="bgAudio" src="" preload="auto" loop crossorigin="anonymous"></audio>

<script>
/* ======================
   Setup & Initialization
   ====================== */
(function(){
  const cfg = window.__NAMICS_CONFIG || {};
  const audioSrc = cfg.audioSrc || 'assets/song.mp3';
  const discordInvite = cfg.discordInvite || 'https://discord.gg/bribe';
  const usernameText = cfg.usernameText || 'namics';
  const subtitleText = cfg.subtitleText || 'creating through chaos';
  const nowLabelText = cfg.nowPlayingLabel || 'Now playing';

  // Elements
  const usernameEl = document.getElementById('username');
  const subtitleEl = document.getElementById('subtitle');
  const discordBtn = document.getElementById('discordBtn');
  const discordText = document.getElementById('discordText');
  const copyBtn = document.getElementById('copyBtn');
  const copyQuick = document.getElementById('copyInviteQuick');
  const toast = document.getElementById('toast');
  const bgAudio = document.getElementById('bgAudio');
  const visualizerEl = document.getElementById('visualizer');
  const nowLabel = document.getElementById('nowLabel');
  const avatarBtn = document.getElementById('avatarBtn');
  const themeToggle = document.getElementById('themeToggle');

  // Apply config strings
  usernameEl.textContent = usernameText;
  usernameEl.setAttribute('data-text', usernameText);
  subtitleEl.textContent = subtitleText;
  nowLabel.textContent = nowLabelText;
  discordText.textContent = (new URL(discordInvite)).host.replace('www.','') + (new URL(discordInvite)).pathname || discordInvite;
  discordBtn.href = discordInvite;
  bgAudio.src = audioSrc;

  // Accessibility: set tabindex etc.
  discordBtn.setAttribute('tabindex','0');
  copyBtn.setAttribute('tabindex','0');
  avatarBtn.setAttribute('aria-pressed','false');

  // copy feedback
  function showToast(msg='Copied!'){
    toast.textContent = msg;
    toast.style.opacity = '1';
    toast.style.transform = 'translateY(0)';
    clearTimeout(window.__toastTimer);
    window.__toastTimer = setTimeout(()=>{ toast.style.opacity='0'; toast.style.transform='translateY(8px)'; }, 1600);
  }

  async function copyInvite(){
    try{
      await navigator.clipboard.writeText(discordInvite);
      showToast('Invite copied');
    }catch(e){
      showToast('Copy failed — manually copy');
      console.warn('copy failed', e);
    }
  }
  copyBtn.addEventListener('click', copyInvite);
  copyQuick && copyQuick.addEventListener('click', copyInvite);

  // discord open in new tab on keyboard Enter
  discordBtn.addEventListener('keydown', function(e){
    if(e.key === 'Enter' || e.key === ' ') {
      e.preventDefault();
      window.open(discordInvite, '_blank', 'noopener');
    }
  });
  discordBtn.addEventListener('click', function(e){
    // open in new tab explicitly for SPA safety
    e.preventDefault();
    window.open(discordInvite, '_blank', 'noopener');
  });

  // theme toggle - toggles light class on root
  const root = document.documentElement;
  let lightMode = false;
  function applyTheme(){
    if(lightMode){ root.classList.add('light'); themeToggle.setAttribute('aria-pressed','true'); themeToggle.textContent='Light' }
    else { root.classList.remove('light'); themeToggle.setAttribute('aria-pressed','false'); themeToggle.textContent='Dark' }
  }
  themeToggle.addEventListener('click', ()=>{
    lightMode = !lightMode;
    applyTheme();
  });
  applyTheme();

  // prevent username select (defensive)
  usernameEl.addEventListener('selectstart', e => e.preventDefault());

  // double-click avatar = confetti easter egg
  // Implementation later in confetti block

  // play audio with autoplay handling
  bgAudio.volume = 0.35;
  async function tryPlay(){
    const p = bgAudio.play();
    if(p && p.then){
      p.catch(()=> {
        const onFirst = ()=>{ bgAudio.play().catch(()=>{}); document.removeEventListener('click',onFirst); }
        document.addEventListener('click', onFirst, {once:true});
      });
    }
  }
  window.addEventListener('load', tryPlay);

  // Build visualizer bars
  const VIS_BARS = 18;
  for(let i=0;i<VIS_BARS;i++){
    const bar = document.createElement('div');
    bar.className='vis-bar';
    bar.style.height = (4 + Math.random()*8) + 'px';
    visualizerEl.appendChild(bar);
  }

  // Audio context & analyser
  let audioCtx, analyser, sourceNode, dataArray;
  function setupAudioAnalyser(){
    try{
      audioCtx = new (window.AudioContext || window.webkitAudioContext)();
      analyser = audioCtx.createAnalyser();
      analyser.fftSize = 256;
      const bufferLength = analyser.frequencyBinCount;
      dataArray = new Uint8Array(bufferLength);
      sourceNode = audioCtx.createMediaElementSource(bgAudio);
      sourceNode.connect(analyser);
      analyser.connect(audioCtx.destination);
      // resume context when required
      document.addEventListener('click', ()=>{ if(audioCtx && audioCtx.state === 'suspended') audioCtx.resume(); }, {once:false});
      drawVisualizer();
    }catch(err){
      console.warn('audio analyser not available', err);
    }
  }

  function drawVisualizer(){
    if(!analyser) return;
    requestAnimationFrame(drawVisualizer);
    analyser.getByteFrequencyData(dataArray);
    // sample bands across array
    const bars = visualizerEl.querySelectorAll('.vis-bar');
    const step = Math.floor(dataArray.length / bars.length);
    bars.forEach((bar, i)=>{
      const sum = dataArray[i*step];
      const h = Math.max(4, (sum/255) * 36);
      bar.style.height = h + 'px';
    });
  }

  // Start audio context when user interacts (if needed)
  function ensureAudioReady(){
    if(!analyser) setupAudioAnalyser();
  }
  document.addEventListener('click', ensureAudioReady, {once:true});
  document.addEventListener('touchstart', ensureAudioReady, {once:true});

  /* ======================
     Particle system: 3 layers, canvas
     ====================== */
  const deepCanvas = document.getElementById('particles-deep');
  const midCanvas = document.getElementById('particles-mid');
  const nearCanvas = document.getElementById('particles-near');

  const canvases = [deepCanvas, midCanvas, nearCanvas];
  let ctxs = canvases.map(c=>c.getContext('2d'));
  function sizeCanvases(){
    canvases.forEach((c,i)=>{
      const dpr = window.devicePixelRatio || 1;
      c.width = Math.ceil(window.innerWidth * dpr);
      c.height = Math.ceil(window.innerHeight * dpr);
      c.style.width = window.innerWidth + 'px';
      c.style.height = window.innerHeight + 'px';
      ctxs[i] = c.getContext('2d');
      ctxs[i].scale(dpr,dpr);
    });
  }
  sizeCanvases();
  window.addEventListener('resize', sizeCanvases);

  // particles arrays
  const particles = { deep:[], mid:[], near:[] };
  function createParticle(layer, i){
    const w = window.innerWidth, h = window.innerHeight;
    return {
      x: Math.random()*w,
      y: Math.random()*h,
      vx: (Math.random()*0.6 - 0.3) * (layer==='near'?1.4:layer==='mid'?0.9:0.5),
      vy: - (0.2 + Math.random()*0.6),
      alpha: 0.1 + Math.random()*0.6,
      size: layer==='near'? (1+Math.random()*2) : layer==='mid'? (0.8+Math.random()*1.2) : (0.6+Math.random()*0.8),
      hueShift: Math.random()*60
    }
  }
  function refillParticles(){
    particles.deep = [];
    particles.mid = [];
    particles.near = [];
    for(let i=0;i<60;i++) particles.deep.push(createParticle('deep', i));
    for(let i=0;i<40;i++) particles.mid.push(createParticle('mid', i));
    for(let i=0;i<28;i++) particles.near.push(createParticle('near', i));
  }
  refillParticles();

  // mouse interaction for repulse/parallax
  const mouse = { x: window.innerWidth/2, y: window.innerHeight/2, down:false };
  window.addEventListener('mousemove', e => { mouse.x = e.clientX; mouse.y = e.clientY; });
  window.addEventListener('mousedown', ()=> mouse.down = true);
  window.addEventListener('mouseup', ()=> mouse.down = false);
  window.addEventListener('touchmove', e => { if(e.touches && e.touches[0]){ mouse.x=e.touches[0].clientX; mouse.y=e.touches[0].clientY } }, {passive:true});

  function renderParticles(){
    // clear each canvas and draw respective particles
    const layers = [['deep', ctxs[0]], ['mid', ctxs[1]], ['near', ctxs[2]]];
    layers.forEach(([layerName, ctx])=>{
      ctx.clearRect(0,0,window.innerWidth, window.innerHeight);
      const arr = particles[layerName];
      arr.forEach(p=>{
        // small attraction/repel based on distance
        const dx = p.x - mouse.x, dy = p.y - mouse.y;
        const dist = Math.sqrt(dx*dx + dy*dy) + 1;
        const repel = Math.max(0, 80 - dist);
        const repelFactor = repel * (layerName==='near'? 0.12 : layerName==='mid'? 0.06 : 0.03);
        p.vx += (dx/dist) * repelFactor;
        p.vy += (dy/dist) * repelFactor * -0.08;

        // natural drift
        p.x += p.vx;
        p.y += p.vy;

        // loop around
        if(p.y < -20) { p.y = window.innerHeight + 10; p.x = Math.random()*window.innerWidth; }
        if(p.x < -40) { p.x = window.innerWidth + 40; }
        if(p.x > window.innerWidth + 40) { p.x = -40; }

        // draw
        ctx.beginPath();
        const grad = ctx.createRadialGradient(p.x, p.y, 0, p.x, p.y, p.size*6);
        // color variations per layer
        if(layerName === 'deep'){
          grad.addColorStop(0, `rgba(138,122,255,${p.alpha*0.18})`);
          grad.addColorStop(1, `rgba(138,122,255,0)`);
        }else if(layerName === 'mid'){
          grad.addColorStop(0, `rgba(255,107,136,${p.alpha*0.18})`);
          grad.addColorStop(1, `rgba(255,107,136,0)`);
        }else{
          grad.addColorStop(0, `rgba(255,255,255,${p.alpha*0.18})`);
          grad.addColorStop(1, `rgba(255,255,255,0)`);
        }
        ctx.fillStyle = grad;
        ctx.arc(p.x, p.y, p.size*3, 0, Math.PI*2);
        ctx.fill();
      });
    });
    requestAnimationFrame(renderParticles);
  }
  requestAnimationFrame(renderParticles);

  /* ======================
     Card parallax / subtle 3D
     ====================== */
  const card = document.getElementById('mainCard');
  let cardW = card.offsetWidth, cardH = card.offsetHeight;
  function onMouseMoveCard(e){
    const rect = card.getBoundingClientRect();
    const cx = rect.left + rect.width/2;
    const cy = rect.top + rect.height/2;
    const dx = (e.clientX - cx) / rect.width;
    const dy = (e.clientY - cy) / rect.height;
    const rx = dy * 6; // rotateX
    const ry = -dx * 8; // rotateY
    card.style.transform = `perspective(900px) rotateX(${rx}deg) rotateY(${ry}deg) translateZ(0)`;
  }
  function resetCard(){
    card.style.transform = '';
  }
  window.addEventListener('mousemove', onMouseMoveCard);
  window.addEventListener('mouseleave', resetCard);

  /* ======================
     Confetti (avatar double-click)
     ====================== */
  const confettiCanvas = document.getElementById('confetti');
  const confCtx = confettiCanvas.getContext('2d');
  function sizeConfetti(){
    const dpr = window.devicePixelRatio || 1;
    confettiCanvas.width = Math.ceil(window.innerWidth * dpr);
    confettiCanvas.height = Math.ceil(window.innerHeight * dpr);
    confettiCanvas.style.width = window.innerWidth + 'px';
    confettiCanvas.style.height = window.innerHeight + 'px';
    confCtx.setTransform(dpr,0,0,dpr,0,0);
  }
  sizeConfetti(); window.addEventListener('resize', sizeConfetti);

  let confettiPieces = [];
  function spawnConfetti(x,y){
    confettiPieces = [];
    const count = 36;
    for(let i=0;i<count;i++){
      confettiPieces.push({
        x: x + (Math.random()-0.5)*40,
        y: y + (Math.random()-0.5)*40,
        vx: (Math.random()-0.5)*12,
        vy: (Math.random()* -6) - 2,
        size: 6 + Math.random()*8,
        rot: Math.random()*360,
        color: (Math.random()>0.5)? `hsl(${200+Math.random()*40},80%,60%)` : `hsl(${320+Math.random()*40},80%,60%)`,
        life: 0
      });
    }
    requestAnimationFrame(tickConfetti);
    setTimeout(()=>{ confettiPieces = []; confCtx.clearRect(0,0,confettiCanvas.width,confettiCanvas.height); }, 3000);
  }
  function tickConfetti(){
    confCtx.clearRect(0,0,confettiCanvas.width,confettiCanvas.height);
    if(confettiPieces.length === 0) return;
    confettiPieces.forEach(p=>{
      p.life += 1/60;
      p.vy += 0.35; // gravity
      p.x += p.vx; p.y += p.vy; p.rot += p.vx*0.5;
      confCtx.save();
      confCtx.translate(p.x, p.y);
      confCtx.rotate(p.rot * Math.PI/180);
      confCtx.fillStyle = p.color;
      confCtx.fillRect(-p.size/2, -p.size/2, p.size, p.size*0.6);
      confCtx.restore();
    });
    requestAnimationFrame(tickConfetti);
  }

  // double-click listener on avatar
  avatarBtn.addEventListener('dblclick', function(e){
    const rect = confettiCanvas.getBoundingClientRect();
    const x = window.innerWidth/2;
    const y = rect.top + rect.height/2;
    spawnConfetti(e.clientX || x, e.clientY || y);
    showToast('✨ surprise');
  });

  // also allow keyboard activation (Enter key) on avatar for accessibility (single press)
  avatarBtn.addEventListener('keydown', (e)=>{
    if(e.key === 'Enter' || e.key === ' '){
      // small bounce effect + confetti
      avatarBtn.animate([{transform:'scale(1)'},{transform:'scale(0.95)'},{transform:'scale(1)'}], {duration:340});
      spawnConfetti(window.innerWidth/2, window.innerHeight/2);
    }
  });

  /* ======================
     Copy / toast is defined above
     ====================== */

  /* ======================
     Accessibility: keyboard shortcuts
     ====================== */
  window.addEventListener('keydown', (e) => {
    if(e.key === 'c' && (e.ctrlKey || e.metaKey)){
      // Ctrl/Cmd + C copies invite
      e.preventDefault(); copyInviteShortcut();
    }
    if(e.key === 't'){ // T toggles theme
      lightModeToggle();
    }
  });
  function copyInviteShortcut(){
    try{ navigator.clipboard.writeText(discordInvite).then(()=>showToast('Invite copied (shortcut)')).catch(()=>showToast('copy failed')); }catch(err){ showToast('copy failed') }
  }

  /* ======================
     Theme helper used by keyboard shortcut
     ====================== */
  let lightMode = false;
  function lightModeToggle(){
    lightMode = !lightMode;
    if(lightMode) document.documentElement.classList.add('light');
    else document.documentElement.classList.remove('light');
    themeToggle.setAttribute('aria-pressed', String(lightMode));
    showToast(lightMode ? 'Light theme' : 'Dark theme');
  }

  // bind UI controls
  themeToggle.addEventListener('click', lightModeToggle);
  copyBtn.addEventListener('click', copyInvite);

  /* ======================
     small ARIA / focus improvements
     ====================== */
  // allow focus ring for keyboard nav only
  function handleFirstTab(e){
    if(e.key === 'Tab'){ document.body.classList.add('user-is-tabbing'); window.removeEventListener('keydown', handleFirstTab); }
  }
  window.addEventListener('keydown', handleFirstTab);

  /* ======================
     STARTUP: audio and analyzer
     ====================== */
  try{
    // set src handled above
    bgAudio.crossOrigin = 'anonymous';
    // ensure audio setup when interacting
    bgAudio.addEventListener('play', ()=> { if(!window.audioAnalyserReady){ setupAudioAnalyser(); window.audioAnalyserReady=true; } });
  }catch(err){
    console.warn('audio setup issue', err);
  }

  // Expose some debug methods on window for dev convenience
  window.__NAMICS_API = {
    copyInvite: copyInvite,
    toggleTheme: lightModeToggle,
    spawnConfetti
  };

  // small polite hint
  setTimeout(()=>{ try{ if(!localStorage.getItem('namics-welcome')){ showToast('Welcome — double-click avatar for surprise'); localStorage.setItem('namics-welcome','1') } }catch(e){} }, 1400);

  // accessibility: make discord button focusable and announce target
  discordBtn.setAttribute('role','link');

  /* ======================
     Audio analyser function defined here for modular usage
     ====================== */
  function setupAudioAnalyser(){
    try{
      if(window.__audioCtx) return;
      const AudioContext = window.AudioContext || window.webkitAudioContext;
      const ctx = new AudioContext();
      window.__audioCtx = ctx;
      const analyser = ctx.createAnalyser();
      analyser.fftSize = 256;
      const source = ctx.createMediaElementSource(bgAudio);
      source.connect(analyser);
      analyser.connect(ctx.destination);
      const bufferLength = analyser.frequencyBinCount;
      const data = new Uint8Array(bufferLength);
      const bars = document.querySelectorAll('.vis-bar');
      function tick(){
        analyser.getByteFrequencyData(data);
        // update bars
        for(let i=0;i<bars.length;i++){
          const idx = Math.floor(i * (data.length / bars.length));
          const v = data[idx];
          const h = Math.max(4, Math.floor((v/255) * 36));
          bars[i].style.height = h + 'px';
        }
        requestAnimationFrame(tick);
      }
      // if no bars exist yet, create
      if(document.querySelectorAll('.vis-bar').length === 0){
        const VIS_BARS = 18;
        for(let i=0;i<VIS_BARS;i++){
          const el = document.createElement('div'); el.className='vis-bar';
          visualizerEl.appendChild(el);
        }
      }
      tick();
    }catch(err){ console.warn('audio analyser err', err) }
  }

})(); // end init IIFE
</script>

<!-- Visualizer DOM is present early; bars will be created by JS if needed -->
<!-- The file intentionally contains many interactive features and modular code for extension -->
</body>
</html>
